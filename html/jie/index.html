<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>基于 layui 的极简社区页面模版</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="keywords" content="java,编程交流社区">
  <meta name="description" content="java,编程交流社区,襄阳人本地的编程社区">
  <link rel="stylesheet" href="/res/layui/css/layui.css">
  <link rel="stylesheet" href="/res/css/global.css">
</head>
<body>

<div class="fly-header layui-bg-black">
  <div class="layui-container">
    <a class="fly-logo" href="/">
      <img src="/res/images/logo.png" alt="layui">猿圈社区
    </a>
    <ul class="layui-nav fly-nav layui-hide-xs">
      <li class="layui-nav-item">
        <a href="https://space.bilibili.com/384704339" target="_blank"><i class="iconfont icon-jiaoliu"></i>交流</a>
      </li>
      <li class="layui-nav-item">
        <a href="/case/case.html"><i class="iconfont icon-iconmingxinganli"></i>精华</a>
      </li>
      <li class="layui-nav-item">
        <a href="/address.html" target="_blank"><i class="iconfont icon-ui"></i>地址</a>
      </li>
    </ul>
    
    <ul class="layui-nav fly-nav-user" id="current-account">

      <li class="layui-nav-item">
        <a class="fly-nav-avatar" href="javascript:;">
          <cite class="layui-hide-xs" id="userAlias"></cite>
          <i class="iconfont icon-renzheng layui-hide-xs" id="authenticate"></i>
          <i class="layui-badge fly-badge-vip layui-hide-xs" id="vipLevel"></i>
          <img id="userImg">
        </a>
        <dl class="layui-nav-child">
          <dd><a href="/user/set.html"><i class="layui-icon">&#xe620;</i>基本设置</a></dd>
          <dd><a href="/user/message.html"><i class="iconfont icon-tongzhi" style="top: 4px;"></i>我的消息</a></dd>
          <dd><a href="/user/home.html"><i class="layui-icon" style="margin-left: 2px; font-size: 22px;">&#xe68e;</i>我的主页</a></dd>
          <hr style="margin: 5px 0;">
          <dd><a href="/user/cleanAll.html" style="text-align: center;">退出</a></dd>
        </dl>
      </li>

    </ul>
  </div>
</div>

<div class="fly-panel fly-column">
  <div class="layui-container">
    <ul class="layui-clear">
      <li class="layui-hide-xs"><a href="/">首页</a></li>
      <li id="htmlBack"><a href="/jie/index.html?classId=1">后端</a></li>
      <li id="htmlFront"><a href="/jie/index.html?classId=2">前端</a></li>
      <li id="htmlData"><a href="/jie/index.html?classId=3">数据</a></li>
      <li id="htmlComplex"><a href="/jie/index.html?classId=4">综合</a></li>
      <li><a href="/timeLine.html">日志</a></li>
      <li class="layui-hide-xs layui-hide-sm layui-show-md-inline-block"><span class="fly-mid"></span></li> 
      
      <!-- 用户登入后显示 -->
      <li id="mysend-port" class="layui-hide-xs layui-hide-sm layui-show-md-inline-block"><a href="/user/index.html#index">我发表的贴</a></li>
      <li id="myfavorites-port" class="layui-hide-xs layui-hide-sm layui-show-md-inline-block"><a href="/user/index.html#collection">我收藏的贴</a></li>
    </ul> 
    
    <div class="fly-column-right layui-hide-xs"> 
      <span class="fly-search"><i class="layui-icon"></i></span> 
      <a href="add.html" class="layui-btn">发表新帖</a> 
    </div> 
    <div class="layui-hide-sm layui-show-xs-block" style="margin-top: -10px; padding-bottom: 10px; text-align: center;"> 
      <a href="add.html" class="layui-btn">发表新帖</a> 
    </div> 
  </div>
</div>

<div class="layui-container">
  <div class="layui-row layui-col-space15">
    <div class="layui-col-md8">
      <div class="fly-panel" style="margin-bottom: 0;">
        
        <div class="fly-panel-title fly-filter" style="overflow: hidden">
          <a id="all_data" href="javascript:changeState('all_data')" class="layui-this">综合</a>
          <span class="fly-mid"></span>
          <a id="in_open" href="javascript:changeState('in_open')">未结</a>
          <span class="fly-mid"></span>
          <a id="in_close" href="javascript:changeState('in_close')">已结</a>
          <span class="fly-mid"></span>
          <a id="is_essence" href="javascript:changeState('is_essence')">精华</a>

          <span class="fly-mid"></span>
          <select class="customselect layui-hide-xs" onchange="selectType(this)" id="datatype">
          </select>

          <span class="fly-filter-right layui-hide-xs">
            <a id="order_time" href="javascript:changeOrder('create_time')" class="layui-this">按最新</a>
            <span class="fly-mid"></span>
            <a id="order_reply" href="javascript:changeOrder('reply_number')">按热议</a>
          </span>
        </div>

        <ul class="fly-list" id="back_portData">
        </ul>
         <div id="back_portNone" class="fly-none">没有相关数据</div>
    
        <div style="text-align: center">
          <div class="laypage-main">
            <a id="homePaging" href="javascript:changePaging('homePaging')" data-id="1">首页</a>
            <a id="lastPaging" href="javascript:changePaging('lastPaging')">上一页</a>
            <a id="nextPaging" href="javascript:changePaging('nextPaging')" >下一页</a>
            <a id="endPaging" href="javascript:changePaging('endPaging')" >尾页</a>
            <a id="curPaging" title="当前页" href="javascript:changePaging('curPaging')">0</a>
          </div>
        </div>

      </div>
    </div>
    <div class="layui-col-md4">
      <dl class="fly-panel fly-list-one" id="initTop">
        <dt class="fly-panel-title">置顶</dt>
      </dl>

      <div class="fly-panel">
        <div class="fly-panel-title">
          合作区域
        </div>
        <div class="fly-panel-main">
          <a href="https://www.aliyun.com/minisite/goods?userCode=qyq0g4ub" target="_blank" class="fly-zanzhu">阿里云 - 服务器特惠</a>
        </div>
      </div>
      
      <div class="fly-panel fly-link">
        <h3 class="fly-panel-title">友情链接</h3>
        <dl class="fly-panel-main">
          <dd><a href="http://www.layui.com/" target="_blank">layui</a><dd>
          <dd><a href="http://layim.layui.com/" target="_blank">WebIM</a><dd>
          <dd><a href="http://layer.layui.com/" target="_blank">layer</a><dd>
          <dd><a href="http://www.layui.com/laydate/" target="_blank">layDate</a><dd>
        </dl>
      </div>

    </div>
  </div>
</div>

<div class="fly-footer">
  <p><a href="/">猿圈社区</a> 2020 &copy; <a href="http://www.kungreat.cn/" target="_blank">kungreat.cn 出品</a></p>
  <p>
    <a href="https://github.com/mydreams2018" target="_blank">GITHUB</a>
    <a href="http://www.beian.miit.gov.cn/" target="_blank">粤ICP备19055569号-1</a>
    <a href="http://www.layui.com/template/fly/" target="_blank">获取Fly社区模版</a>
  </p>
</div>

<script type="application/javascript">
  var UrlParm = function () {
    var data, index;
    (function init() {
      data = [];
      index = {};
      var u = window.location.search.substr(1);
      if (u != '') {
        var parms = decodeURIComponent(u).split('&');
        for (var i = 0, len = parms.length; i < len; i++) {
          if (parms[i] != '') {
            var p = parms[i].split("=");
            if (p.length == 1 || (p.length == 2 && p[1] == '')) {
              data.push(['']);
              index[p[0]] = data.length - 1;
            } else if (typeof (p[0]) == 'undefined' || p[0] == '') {
              data[0] = [p[1]];
            } else if (typeof (index[p[0]]) == 'undefined') {
              data.push([p[1]]);
              index[p[0]] = data.length - 1;
            } else {
              data[index[p[0]]].push(p[1]);
            }
          }
        }
      }
    })();
    return {
      parm: function (o) {
        try {
          return (typeof (o) == 'number' ? data[o][0] : data[index[o]][0]);
        } catch (e) {
        }
      },
      parmValues: function (o) {
        try {
          return (typeof (o) == 'number' ? data[o] : data[index[o]]);
        } catch (e) { }
      },
      hasParm: function (parmName) {
        return typeof (parmName) == 'string' ? typeof (index[parmName]) != 'undefined' : false;
      },
      parmMap: function () {
        var map = {};
        try {
          for (var p in index) { map[p] = data[index[p]]; }
        } catch (e) { }
        return map;
      }
    }
  } ();
  classId =  UrlParm.parm("classId")?UrlParm.parm("classId"):1;
  switch (classId) {
    case "1":
     document.getElementById("htmlBack").setAttribute("class","layui-this");
      break;
    case "2":
      document.getElementById("htmlFront").setAttribute("class","layui-this");
      break;
    case "3":
      document.getElementById("htmlData").setAttribute("class","layui-this");
      break;
    case "4":
      document.getElementById("htmlComplex").setAttribute("class","layui-this");
      break;
  };
  var cusxhr = new XMLHttpRequest();//第一步：新建对象
  cusxhr.onreadystatechange = function(){
    if (cusxhr.readyState == 4 && cusxhr.status == 200) {
      var  data = JSON.parse(cusxhr.responseText)[classId];
      for(var x=0;x<data.length;x++){
        var tmoption = document.createElement('option');
        document.getElementById("datatype").appendChild(tmoption);
        tmoption.value=data[x];
        tmoption.text=data[x];
      }
    }
  };
  cusxhr.open('GET', '/common/typesData.json', false);//第二步：打开连接  将请求参数写在url中
  cusxhr.send();//第三步：发送请求  将请求参数写在URL中
</script>

<script src="/res/layui/layui.js"></script>
<script>
  var datatype = document.getElementById("datatype").value;
  var portState;
  var isEssence;
  var orderType = 'create_time';
  var currentPage = 1;
  var titleSearch;
layui.cache.page = 'jie';
layui.config({
  version: "3.0.0"
  ,base: '/res/mods/'
}).extend({
  account: 'currentAccount',
  fly: 'index'
}).use(['account','fly'],function(){
  if(layui.cache.user.state != 1){
    layui.$("#mysend-port").remove();
    layui.$("#myfavorites-port").remove();
  };
  //搜索
  layui.$('.fly-search').on('click', function(){
    layui.layer.open({
      type: 1
      ,title: false
      ,closeBtn: true
      //,shade: [0.1, '#fff']
      ,shadeClose: true
      ,maxWidth: 10000
      ,skin: 'fly-layer-search'
      ,content: ['<form action="/">'
        ,'<input autocomplete="off" placeholder="搜索内容,回车查询" type="text" name="q">'
        ,'</form>'].join('')
      ,success: function(layero){
        var input = layero.find('input');
        input.focus();
        if(titleSearch && titleSearch!=''){
          input.val(titleSearch);
        }
        layero.find('form').submit(function(e){
          e.preventDefault();//取消表单提交事件
          var dts = input.val().replace(/(^\s*)|(\s*$)/g, "");
          layui.layer.closeAll('page');//关闭弹窗
          titleSearch = dts;
          getPortData();
        });
      }
    })
  });
  getPortData();
  initTopData();
});
function selectType(obj){
  datatype=obj.value;
  getPortData();
};
function changeState(value){
  layui.$("#all_data").removeClass('layui-this');
  layui.$("#in_open").removeClass('layui-this');
  layui.$("#in_close").removeClass('layui-this');
  layui.$("#is_essence").removeClass('layui-this');
  layui.$('#'+value).addClass('layui-this');
  portState=null;
  isEssence=null;
  switch (layui.$('#'+value).text()) {
    case '未结':
      portState='未结';
      break;
    case '已结':
      portState='已结';
      break;
    case '精华':
      isEssence=1;
  };
  getPortData();
};
function changeOrder(value) {
  layui.$("#order_time").removeClass('layui-this');
  layui.$("#order_reply").removeClass('layui-this');
  orderType = value;
  switch (value) {
    case 'create_time':
      layui.$("#order_time").addClass('layui-this');
      break;
    case 'reply_number':
      layui.$("#order_reply").addClass('layui-this');
      break;
  };
  getPortData();
};
function changePaging(obj){
  if(document.getElementById(obj).getAttribute("data-id") != currentPage) {
    currentPage = document.getElementById(obj).getAttribute("data-id");
    getPortData();
  }
};
function getPortData(){
  layui.$.ajax({
    url: "/api/report/queryReport",
    type: "post",
    dataType: "json",
    async: false,
    data: {
      'datatype':datatype,
      'portState':portState,
      'isEssence':isEssence,
      'orderType':orderType,
      'currentPage':currentPage,
      'classId':classId,
      'name': titleSearch
    },
    success: function (res) {
        if(res && res.datas.length > 0){
          layui.$("#back_portNone").addClass('layui-hide');
          layui.$("#back_portData").removeClass('layui-hide');
          layui.$("#back_portData").empty();
          for(var x=0;x<res.datas.length;x++){
            var resData = res.datas[x];
            var str = "<li>\n"+
                    "            <a href=\"/user/home.html?alias={alias}\" class=\"fly-avatar\">\n" +
                    "              <img src=\"{userImg}\" alt=\"xx\">\n" +
                    "            </a>\n" +
                    "\t\t\t\n" +
                    "            <h2>\n" +
                    "              <a class=\"layui-badge\">分享</a>\n" +
                    "              <a href=\"/jie/detail.html?classId="+classId+"&id={portId}\">{portTitle}</a>\n" +
                    "            </h2>\n" +
                    "            <div class=\"fly-list-info\">\n" +
                    "              <a href=\"/user/home.html?alias={alias}\" link>\n" +
                    "                <cite>{alias}</cite>\n";
                    str = str + "<i class=\"iconfont icon-renzheng\" title=\"认证信息：{authenticate}\"></i>\n";
                    str = str + "<i class=\"layui-badge fly-badge-vip\">{vipLevel}</i>\n";
                    str = str + "  </a>\n"
                            + "   <span>{createTime}</span>\n"
                            + "  \n"
                            +  "  <span class=\"fly-list-kiss layui-hide-xs\" title=\"悬赏飞吻\"><i class=\"iconfont icon-kiss\"></i> {experience}</span>\n"
                            +  "  <span class=\"layui-badge fly-badge-accept layui-hide-xs\">{portState}</span>\n"
                            +  " <span class=\"fly-list-nums\"> \n"
                            + "  <i class=\"iconfont icon-pinglun1\" title=\"回答\"></i> {replyNumber}\n"
                            +  "    </span>\n"
                            + " </div>\n";
                    if(resData.isTop || resData.isEssence){
                        if(resData.isTop && resData.isEssence){
                          str = str + " <div class=\"fly-list-badge\">\n" +
                                  "              <span class=\"layui-badge layui-bg-black\">置顶</span>\n" +
                                  "              <span class=\"layui-badge layui-bg-red\">精帖</span>\n" +
                                  "            </div>";
                        }else if(resData.isEssence){
                          str = str + "  <div class=\"fly-list-badge\">\n" +
                                   "           <span class=\"layui-badge layui-bg-red\">精帖</span>\n" +
                                   "            </div>";
                        }else{
                          str = str + "<div class=\"fly-list-badge\">\n" +
                                  "              <span class=\"layui-badge layui-bg-black\">置顶</span>\n" +
                                  "            </div>";
                        }
                    };
                    str = str +  "</li>";
                    var rt = str.replace(/{userImg}/g,resData.userImg).replace(/{alias}/g,resData.alias)
                    .replace(/{portTitle}/g,resData.name).replace(/{portId}/g,resData.id)
                    .replace(/{authenticate}/g,resData.authenticate?resData.authenticate:'无').replace(/{vipLevel}/g,resData.vipLevel)
                    .replace(/{createTime}/g,resData.createTime).replace(/{experience}/g,resData.experience)
                    .replace(/{portState}/g,resData.portState).replace(/{replyNumber}/g,resData.replyNumber);
                    document.getElementById("back_portData").appendChild(layui.$(rt)[0]);
          }
        }else{
          layui.$("#back_portNone").removeClass('layui-hide');
          layui.$("#back_portData").addClass('layui-hide');
        }
      document.getElementById("lastPaging").setAttribute("data-id",res.page.lastPage);
      document.getElementById("nextPaging").setAttribute("data-id",res.page.nextPage);
      document.getElementById("endPaging").setAttribute("data-id",res.page.endPage);
      document.getElementById("curPaging").innerText=res.page.currentPage+'/'+res.page.endPage;
      currentPage = res.page.currentPage;
    },
    error: function () {
      layui.$("#back_portNone").removeClass('layui-hide');
      layui.$("#back_portData").addClass('layui-hide');
    }
  });
};
function initTopData() {
  layui.$.ajax({
    url: "/api/report/queryReport",
    type: "post",
    dataType: "json",
    async: false,
    data: {
      'isTop':1,
      'orderType':orderType,
      'classId':classId
    },
    error: function (res) {
      document.getElementById("initTop").appendChild(layui.$("<div class=\"fly-none\">没有相关数据</div>")[0]);
    },
    success: function (res) {
      if(res && res.datas.length > 0){
        var str ="      <dd>\n" +
                "          <a href=\"/jie/detail.html?classId="+classId+"&id={portId}\">{portTitle}</a>\n" +
                "          <span><i class=\"iconfont icon-pinglun1\"></i> {replyNumber}</span>\n" +
                "        </dd>";
        for(var x=0;x<res.datas.length;x++){
          var resData = res.datas[x];
          var rt = str.replace(/{portTitle}/g,resData.name).replace(/{portId}/g,resData.id).replace(/{replyNumber}/g,resData.replyNumber);
          document.getElementById("initTop").appendChild(layui.$(rt)[0]);
        }
      }else{
        document.getElementById("initTop").appendChild(layui.$("<div class=\"fly-none\">没有相关数据</div>")[0]);
      }
    }
  })
};
</script>

</body>
</html>